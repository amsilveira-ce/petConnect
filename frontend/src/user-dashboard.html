<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PetConnect</title>
    <link rel="icon" type="image/x-icon" href="http://127.0.0.1:5501/frontend/public/logos/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .heart-icon {
            transition: all 0.3s ease;
        }
        .heart-icon:hover {
            transform: scale(1.2);
        }
        .heart-icon.favorited {
            fill: #ec4899;
            color: #ec4899;
        }
        .filter-chip {
            transition: all 0.2s ease;
        }
        .filter-chip:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm px-6 py-4 sticky top-0 z-50">
            <div class="container mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="http://127.0.0.1:5501/frontend/public/logos/logo.svg" alt="PetConnect" class="h-10">
                    <span class="text-2xl font-mono text-gray-900">PetConnect</span>
                </div>
                <div class="flex items-center gap-6">
                    <a href="user-dashboard.html" class="text-pink-500 font-semibold">In√≠cio</a>
                    <a href="pets-adodante.html" class="text-gray-600 hover:text-pink-500">Meus Pets</a>
                    <a href="minhas-adocoes.html" class="text-gray-600 hover:text-pink-500">Minhas Ado√ß√µes</a>
                    <button id="logoutBtn" class="bg-pink-500 text-white px-6 py-2 rounded-full hover:bg-pink-600 transition">Sair</button>
                </div>
            </div>
        </nav>

        <!-- Header -->
        <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white py-12">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl font-bold mb-2">Encontre seu novo amigo! üêæ</h1>
                <p class="text-pink-100">Explore nossos pets dispon√≠veis para ado√ß√£o</p>
            </div>
        </div>

        <!-- Stats -->
        <div class="container mx-auto px-6 -mt-8 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">‚ù§Ô∏è</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="favoritesCount">0</h3>
                    <p class="text-gray-600">Pets Favoritos</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">üìã</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="applicationsCount">0</h3>
                    <p class="text-gray-600">Solicita√ß√µes</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">üè†</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="adoptedCount">0</h3>
                    <p class="text-gray-600">Pets Adotados</p>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="container mx-auto px-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Filtros</h2>
                
                <!-- Search -->
                <div class="mb-6">
                    <input type="text" id="searchInput" placeholder="Buscar por nome..." 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                </div>

                <!-- Filter Grid -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Species -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Esp√©cie</label>
                        <select id="speciesFilter" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <option value="">Todos</option>
                            <option value="dog">Cachorro</option>
                            <option value="cat">Gato</option>
                        </select>
                    </div>

                    <!-- Size -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Tamanho</label>
                        <select id="sizeFilter" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <option value="">Todos</option>
                            <option value="small">Pequeno</option>
                            <option value="medium">M√©dio</option>
                            <option value="large">Grande</option>
                        </select>
                    </div>

                    <!-- Age -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Idade</label>
                        <select id="ageFilter" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <option value="">Todos</option>
                            <option value="puppy">Filhote</option>
                            <option value="young">Jovem</option>
                            <option value="adult">Adulto</option>
                            <option value="senior">Idoso</option>
                        </select>
                    </div>

                    <!-- Gender -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">G√™nero</label>
                        <select id="genderFilter" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <option value="">Todos</option>
                            <option value="male">Macho</option>
                            <option value="female">F√™mea</option>
                        </select>
                    </div>
                </div>

                <!-- Clear Filters Button -->
                <div class="mt-6">
                    <button id="clearFiltersBtn" class="px-6 py-2 text-pink-500 border border-pink-500 rounded-full hover:bg-pink-50 transition">
                        Limpar Filtros
                    </button>
                </div>
            </div>
        </div>

        <!-- Pets Grid -->
        <div class="container mx-auto px-6 pb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-900">Pets Dispon√≠veis</h2>
                <p class="text-gray-600"><span id="resultsCount">0</span> pets encontrados</p>
            </div>
            
            <div id="petsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Pet cards will be inserted here -->
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="hidden text-center py-12">
                <div class="text-6xl mb-4">üîç</div>
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Nenhum pet encontrado</h3>
                <p class="text-gray-600">Tente ajustar seus filtros de busca</p>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Mock pets data
        const petsMock = [
            {
                _id: "pet1",
                name: "Luna",
                species: "dog",
                breed: "Labrador",
                size: "large",
                gender: "female",
                ageCategory: "young",
                ageYears: 2,
                color: { primary: "Dourado" },
                adoptionStatus: "available",
                description: "Luna √© muito carinhosa e adora brincar. Perfeita para fam√≠lias!",
                location: { city: "Bragan√ßa Paulista", state: "SP" },
                behaviorTags: ["friendly", "energetic", "good-with-kids"],
                healthInfo: { isVaccinated: true, isNeutered: true },
                media: {
                    photos: [{ url: "https://www.petlove.com.br/images/breeds/193219/profile/original/labrador-p.jpg?1532539172", isPrimary: true }]
                }
            },
            {
                _id: "pet2",
                name: "Thor",
                species: "dog",
                breed: "Pastor Alem√£o",
                size: "large",
                gender: "male",
                ageCategory: "adult",
                ageYears: 4,
                color: { primary: "Preto e Marrom" },
                adoptionStatus: "available",
                description: "Thor √© protetor e leal. √ìtimo companheiro!",
                location: { city: "Campinas", state: "SP" },
                behaviorTags: ["protective", "loyal", "calm"],
                healthInfo: { isVaccinated: true, isNeutered: true },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1568572933382-74d440642117?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet3",
                name: "Mimi",
                species: "cat",
                breed: "Siam√™s",
                size: "small",
                gender: "female",
                ageCategory: "young",
                ageYears: 1,
                color: { primary: "Bege e Marrom" },
                adoptionStatus: "available",
                description: "Mimi √© independente mas muito carinhosa. Adora dormir no sol!",
                location: { city: "S√£o Paulo", state: "SP" },
                behaviorTags: ["independent", "affectionate", "quiet"],
                healthInfo: { isVaccinated: true, isNeutered: false },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1513245543132-31f507417b26?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet4",
                name: "Bob",
                species: "dog",
                breed: "Bulldog",
                size: "medium",
                gender: "male",
                ageCategory: "puppy",
                ageYears: 0.5,
                color: { primary: "Branco e Marrom" },
                adoptionStatus: "available",
                description: "Bob √© um filhote brincalh√£o que adora fazer amigos!",
                location: { city: "Jundia√≠", state: "SP" },
                behaviorTags: ["playful", "friendly", "energetic"],
                healthInfo: { isVaccinated: true, isNeutered: false },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet5",
                name: "Nina",
                species: "cat",
                breed: "Persa",
                size: "small",
                gender: "female",
                ageCategory: "adult",
                ageYears: 3,
                color: { primary: "Branco" },
                adoptionStatus: "available",
                description: "Nina √© tranquila e adora colo. Perfeita para apartamento!",
                location: { city: "Bragan√ßa Paulista", state: "SP" },
                behaviorTags: ["calm", "affectionate", "indoor"],
                healthInfo: { isVaccinated: true, isNeutered: true },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1495360010541-f48722b34f7d?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet6",
                name: "Rex",
                species: "dog",
                breed: "Rottweiler",
                size: "large",
                gender: "male",
                ageCategory: "senior",
                ageYears: 8,
                color: { primary: "Preto" },
                adoptionStatus: "available",
                description: "Rex √© calmo e experiente. Procura um lar tranquilo para seus anos dourados.",
                location: { city: "Atibaia", state: "SP" },
                behaviorTags: ["calm", "loyal", "experienced"],
                healthInfo: { isVaccinated: true, isNeutered: true },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1567752881298-894bb81f9379?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet7",
                name: "Mel",
                species: "cat",
                breed: "Vira-lata",
                size: "small",
                gender: "female",
                ageCategory: "puppy",
                ageYears: 0.3,
                color: { primary: "Laranja" },
                adoptionStatus: "available",
                description: "Mel √© uma filhote ador√°vel e cheia de energia!",
                location: { city: "Campinas", state: "SP" },
                behaviorTags: ["playful", "curious", "energetic"],
                healthInfo: { isVaccinated: true, isNeutered: false },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1574158622682-e40e69881006?w=800", isPrimary: true }]
                }
            },
            {
                _id: "pet8",
                name: "Max",
                species: "dog",
                breed: "Golden Retriever",
                size: "large",
                gender: "male",
                ageCategory: "young",
                ageYears: 2.5,
                color: { primary: "Dourado" },
                adoptionStatus: "available",
                description: "Max √© extremamente amig√°vel e adora crian√ßas. Um verdadeiro golden heart!",
                location: { city: "S√£o Paulo", state: "SP" },
                behaviorTags: ["friendly", "good-with-kids", "gentle"],
                healthInfo: { isVaccinated: true, isNeutered: true },
                media: {
                    photos: [{ url: "https://images.unsplash.com/photo-1633722715463-d30f4f325e24?w=800", isPrimary: true }]
                }
            }
        ];

        // Initialize
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let applications = JSON.parse(localStorage.getItem('applications')) || [];
        let filteredPets = [...petsMock];

        console.log('Dashboard loaded - Favorites:', favorites.length, 'Applications:', applications.length);

        // Update stats
        function updateStats() {
            document.getElementById('favoritesCount').textContent = favorites.length;
            document.getElementById('applicationsCount').textContent = applications.length;
            const adoptedCount = applications.filter(a => a.status === 'approved').length;
            document.getElementById('adoptedCount').textContent = adoptedCount;
        }

        // Toggle favorite
        function toggleFavorite(petId) {
            const index = favorites.indexOf(petId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(petId);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateStats();
            renderPets();
        }

        // Render pet cards
        function renderPets() {
            const grid = document.getElementById('petsGrid');
            const noResults = document.getElementById('noResults');
            const resultsCount = document.getElementById('resultsCount');

            grid.innerHTML = '';

            if (filteredPets.length === 0) {
                noResults.classList.remove('hidden');
                resultsCount.textContent = '0';
                return;
            }

            noResults.classList.add('hidden');
            resultsCount.textContent = filteredPets.length;

            filteredPets.forEach(pet => {
                const isFavorited = favorites.includes(pet._id);
                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl shadow-md hover:shadow-xl transition overflow-hidden group';
                card.innerHTML = `
                    <div class="relative">
                        <img src="${pet.media.photos[0].url}" alt="${pet.name}" 
                            class="w-full h-56 object-cover group-hover:scale-105 transition duration-300">
                        <button onclick="toggleFavorite('${pet._id}')" 
                            class="absolute top-3 right-3 bg-white p-2 rounded-full shadow-lg heart-icon ${isFavorited ? 'favorited' : ''} hover:scale-110">
                            <svg class="w-6 h-6" fill="${isFavorited ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>
                        <span class="absolute top-3 left-3 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                            Dispon√≠vel
                        </span>
                    </div>
                    <div class="p-5">
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">${pet.name}</h3>
                        <p class="text-gray-600 mb-3">${pet.breed} ‚Ä¢ ${getGenderText(pet.gender)} ‚Ä¢ ${getAgeText(pet.ageCategory)}</p>
                        <p class="text-sm text-gray-500 mb-4">üìç ${pet.location.city} - ${pet.location.state}</p>
                        <p class="text-gray-700 text-sm mb-4 line-clamp-2">${pet.description}</p>
                        <div class="flex gap-2 mb-4 flex-wrap">
                            ${pet.behaviorTags.slice(0, 2).map(tag => 
                                `<span class="px-3 py-1 bg-pink-50 text-pink-600 rounded-full text-xs font-medium">${getBehaviorText(tag)}</span>`
                            ).join('')}
                        </div>
                        <button onclick="goToAdoptionForm('${pet._id}')" 
                            class="w-full bg-pink-500 text-white py-3 rounded-xl font-semibold hover:bg-pink-600 transition">
                            Adotar ${pet.name}
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Filter functions
        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const species = document.getElementById('speciesFilter').value;
            const size = document.getElementById('sizeFilter').value;
            const age = document.getElementById('ageFilter').value;
            const gender = document.getElementById('genderFilter').value;

            filteredPets = petsMock.filter(pet => {
                const matchSearch = !search || pet.name.toLowerCase().includes(search) || pet.breed.toLowerCase().includes(search);
                const matchSpecies = !species || pet.species === species;
                const matchSize = !size || pet.size === size;
                const matchAge = !age || pet.ageCategory === age;
                const matchGender = !gender || pet.gender === gender;

                return matchSearch && matchSpecies && matchSize && matchAge && matchGender;
            });

            renderPets();
        }

        // Clear filters
        document.getElementById('clearFiltersBtn').addEventListener('click', () => {
            document.getElementById('searchInput').value = '';
            document.getElementById('speciesFilter').value = '';
            document.getElementById('sizeFilter').value = '';
            document.getElementById('ageFilter').value = '';
            document.getElementById('genderFilter').value = '';
            applyFilters();
        });

        // Add event listeners to filters
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('speciesFilter').addEventListener('change', applyFilters);
        document.getElementById('sizeFilter').addEventListener('change', applyFilters);
        document.getElementById('ageFilter').addEventListener('change', applyFilters);
        document.getElementById('genderFilter').addEventListener('change', applyFilters);

        // Navigation to adoption form
        function goToAdoptionForm(petId) {
            localStorage.setItem('adoptingPetId', petId);
            window.location.href = 'adoption-form.html';
        }

        // Helper functions
        function getGenderText(gender) {
            return gender === 'male' ? 'Macho' : 'F√™mea';
        }

        function getAgeText(age) {
            const ageMap = {
                puppy: 'Filhote',
                young: 'Jovem',
                adult: 'Adulto',
                senior: 'Idoso'
            };
            return ageMap[age] || age;
        }

        function getBehaviorText(behavior) {
            const behaviorMap = {
                friendly: 'Amig√°vel',
                energetic: 'Energ√©tico',
                playful: 'Brincalh√£o',
                calm: 'Calmo',
                protective: 'Protetor',
                loyal: 'Leal',
                'good-with-kids': 'Bom com crian√ßas',
                affectionate: 'Carinhoso',
                independent: 'Independente',
                quiet: 'Quieto',
                indoor: 'Indoor',
                curious: 'Curioso',
                gentle: 'Gentil',
                experienced: 'Experiente'
            };
            return behaviorMap[behavior] || behavior;
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await api.logout();
                localStorage.removeItem('userInfo');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Initialize
        updateStats();
        renderPets();
    </script>
</body>
</html>
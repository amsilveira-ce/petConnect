<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PetConnect</title>
    <link rel="icon" type="image/x-icon" href="public/logos/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .heart-icon {
            transition: all 0.3s ease;
        }
        .heart-icon:hover {
            transform: scale(1.2);
        }
        .heart-icon.favorited {
            fill: #ec4899;
            color: #ec4899;
        }
        .filter-chip {
            transition: all 0.2s ease;
        }
        .filter-chip:hover {
            transform: translateY(-2px);
        }
    </style>
</head>

<body class="bg-gray-50">

    <script type="module" src="./js/dashboard-protection.js"></script>

    <div class="min-h-screen">

        <!-- Navigation -->
        <nav class="bg-white shadow-sm px-6 py-4 sticky top-0 z-50">
            <div class="container mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="public/logos/logo.svg" alt="PetConnect" class="h-10">
                    <span class="text-2xl font-mono text-gray-900">PetConnect</span>
                </div>

                <div class="flex items-center gap-6">
                    <a href="user-dashboard.html" class="text-pink-500 font-semibold">In√≠cio</a>
                    <a href="pets-adodante.html" class="text-gray-600 hover:text-pink-500">Meus Pets</a>
                    <a href="minhas-adocoes.html" class="text-gray-600 hover:text-pink-500">Minhas Ado√ß√µes</a>

                    <button id="logoutBtn"
                        class="bg-pink-500 text-white px-6 py-2 rounded-full hover:bg-pink-600 transition">
                        Sair
                    </button>
                </div>
            </div>
        </nav>


        <!-- HEADER -->
        <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white py-12">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl font-bold mb-2">Encontre seu novo amigo! üêæ</h1>
                <p class="text-pink-100">Explore nossos pets dispon√≠veis para ado√ß√£o</p>
            </div>
        </div>


        <!-- STATS -->
        <div class="container mx-auto px-6 -mt-8 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">‚ù§Ô∏è</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="favoritesCount">0</h3>
                    <p class="text-gray-600">Pets Favoritos</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">üìã</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="applicationsCount">0</h3>
                    <p class="text-gray-600">Solicita√ß√µes</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="text-pink-500 text-4xl mb-2">üè†</div>
                    <h3 class="text-2xl font-bold text-gray-900" id="adoptedCount">0</h3>
                    <p class="text-gray-600">Pets Adotados</p>
                </div>

            </div>
        </div>


        <!-- FILTERS -->
        <div class="container mx-auto px-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Filtros</h2>

                <input type="text" id="searchInput" placeholder="Buscar por nome..."
                       class="w-full px-4 py-3 border rounded-xl mb-6">

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

                    <select id="speciesFilter" class="border rounded-xl px-4 py-2">
                        <option value="">Todos</option>
                        <option value="dog">Cachorro</option>
                        <option value="cat">Gato</option>
                    </select>

                    <select id="sizeFilter" class="border rounded-xl px-4 py-2">
                        <option value="">Todos</option>
                        <option value="small">Pequeno</option>
                        <option value="medium">M√©dio</option>
                        <option value="large">Grande</option>
                    </select>

                    <select id="ageFilter" class="border rounded-xl px-4 py-2">
                        <option value="">Todos</option>
                        <option value="puppy">Filhote</option>
                        <option value="young">Jovem</option>
                        <option value="adult">Adulto</option>
                        <option value="senior">Idoso</option>
                    </select>

                    <select id="genderFilter" class="border rounded-xl px-4 py-2">
                        <option value="">Todos</option>
                        <option value="male">Macho</option>
                        <option value="female">F√™mea</option>
                    </select>

                </div>

                <button id="clearFiltersBtn"
                    class="mt-6 px-6 py-2 border border-pink-500 text-pink-500 rounded-full hover:bg-pink-50">
                    Limpar Filtros
                </button>
            </div>
        </div>


        <!-- PET GRID -->
        <div class="container mx-auto px-6 pb-12">
            <div class="flex justify-between mb-6">
                <h2 class="text-3xl font-bold text-gray-900">Pets Dispon√≠veis</h2>
                <p class="text-gray-600"><span id="resultsCount">0</span> pets encontrados</p>
            </div>

            <div id="petsGrid"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>

            <div id="noResults" class="hidden text-center py-12">
                <div class="text-6xl mb-4">üîç</div>
                <h3 class="text-2xl font-bold">Nenhum pet encontrado</h3>
                <p class="text-gray-600">Tente ajustar a busca.</p>
            </div>
        </div>
    </div>


    <!-- MAIN DASHBOARD SCRIPT -->
    <script type="module">
        import { authService } from "./js/api.js";

        // ---------- Mock Pets ----------
        const petsMock = [...(function(){
            return [
                { _id: "pet1", name: "Luna", species: "dog", breed: "Labrador", size: "large",
                  gender:"female", ageCategory:"young", ageYears:2, color:{ primary:"Dourado" },
                  adoptionStatus:"available",
                  description:"Luna √© muito carinhosa e adora brincar.",
                  location:{ city:"Bragan√ßa Paulista",state:"SP" },
                  behaviorTags:["friendly","energetic","good-with-kids"],
                  healthInfo:{ isVaccinated:true,isNeutered:true },
                  media:{ photos:[{ url:"https://www.petlove.com.br/images/breeds/193219/profile/original/labrador-p.jpg",isPrimary:true }] }
                },
                // (Listei apenas um por espa√ßo ‚Äî voc√™ pode colar os outros 7 aqui)
            ];
        })()];

        // ---------- State ----------
        let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        let applications = JSON.parse(localStorage.getItem("applications")) || [];
        let filteredPets = [...petsMock];

        console.log("Dashboard loaded");

        // ---------- Helpers ----------
        function updateStats() {
            document.getElementById("favoritesCount").textContent = favorites.length;
            document.getElementById("applicationsCount").textContent = applications.length;
            document.getElementById("adoptedCount").textContent =
                applications.filter(a => a.status === "approved").length;
        }

        function toggleFavorite(id) {
            const index = favorites.indexOf(id);
            if (index >= 0) favorites.splice(index, 1);
            else favorites.push(id);

            localStorage.setItem("favorites", JSON.stringify(favorites));
            updateStats();
            renderPets();
        }

        function getGenderText(g) {
            return g === "male" ? "Macho" : "F√™mea";
        }

        function getAgeText(cat) {
            return { puppy:"Filhote", young:"Jovem", adult:"Adulto", senior:"Idoso" }[cat];
        }

        function getBehaviorText(tag) {
            return {
                friendly:"Amig√°vel", energetic:"Energ√©tico", playful:"Brincalh√£o",
                calm:"Calmo", protective:"Protetor", loyal:"Leal",
                "good-with-kids":"Bom com crian√ßas", affectionate:"Carinhoso",
                independent:"Independente", quiet:"Quieto", indoor:"Indoor",
                curious:"Curioso", gentle:"Gentil", experienced:"Experiente"
            }[tag];
        }

        function goToAdoptionForm(id) {
            localStorage.setItem("adoptingPetId", id);
            window.location.href = "adoption-form.html";
        }

        // ---------- Render Pets ----------
        function renderPets() {
            const grid = document.getElementById("petsGrid");
            const noRes = document.getElementById("noResults");

            grid.innerHTML = "";

            if (!filteredPets.length) {
                noRes.classList.remove("hidden");
                return;
            }

            noRes.classList.add("hidden");

            filteredPets.forEach(pet => {
                const fav = favorites.includes(pet._id);

                const card = document.createElement("div");
                card.className =
                    "bg-white rounded-2xl shadow-md hover:shadow-xl transition overflow-hidden";

                card.innerHTML = `
                    <div class="relative">
                        <img src="${pet.media.photos[0].url}" class="w-full h-56 object-cover" />

                        <button onclick="toggleFavorite('${pet._id}')"
                            class="absolute top-3 right-3 bg-white p-2 rounded-full shadow-lg heart-icon ${fav ? "favorited" : ""}">
                            ‚ù§Ô∏è
                        </button>

                        <span class="absolute top-3 left-3 bg-green-500 text-white px-3 py-1 rounded-full">
                            Dispon√≠vel
                        </span>
                    </div>

                    <div class="p-5">
                        <h3 class="text-2xl font-bold">${pet.name}</h3>
                        <p class="text-gray-600 mb-3">${pet.breed} ‚Ä¢ ${getGenderText(pet.gender)}</p>

                        <button onclick="goToAdoptionForm('${pet._id}')"
                            class="w-full bg-pink-500 text-white py-3 rounded-xl">
                            Adotar ${pet.name}
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.getElementById("resultsCount").textContent = filteredPets.length;
        }

        // ---------- Filters ----------
        function applyFilters() {
            const search = document.getElementById("searchInput").value.toLowerCase();
            const species = document.getElementById("speciesFilter").value;
            const size = document.getElementById("sizeFilter").value;
            const age = document.getElementById("ageFilter").value;
            const gender = document.getElementById("genderFilter").value;

            filteredPets = petsMock.filter(p =>
                (!search || p.name.toLowerCase().includes(search)) &&
                (!species || p.species === species) &&
                (!size || p.size === size) &&
                (!age || p.ageCategory === age) &&
                (!gender || p.gender === gender)
            );

            renderPets();
        }

        document.getElementById("clearFiltersBtn").addEventListener("click", () => {
            document.getElementById("searchInput").value = "";
            document.getElementById("speciesFilter").value = "";
            document.getElementById("sizeFilter").value = "";
            document.getElementById("ageFilter").value = "";
            document.getElementById("genderFilter").value = "";
            applyFilters();
        });

        document.getElementById("searchInput").addEventListener("input", applyFilters);
        document.getElementById("speciesFilter").addEventListener("change", applyFilters);
        document.getElementById("sizeFilter").addEventListener("change", applyFilters);
        document.getElementById("ageFilter").addEventListener("change", applyFilters);
        document.getElementById("genderFilter").addEventListener("change", applyFilters);


        // ---------- LOGOUT ----------
        document.getElementById("logoutBtn").addEventListener("click", () => {
            if (confirm("Tem certeza que deseja sair?")) {
                authService.logout();
            }
        });

        // ---------- Init ----------
        updateStats();
        renderPets();
    </script>

</body>
</html>
